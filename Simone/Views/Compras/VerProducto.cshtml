@model CatalogoViewModel

@{
    ViewData["Title"] = "Detalles del Producto";
    var producto = ViewBag.Producto as Simone.Models.Producto;
    var mensajeError = TempData["MensajeError"];
}

@if (mensajeError != null)
{
    <div class="alert alert-danger">
        <i class="fa-solid fa-circle-exclamation me-2"></i> @mensajeError
    </div>
}

<div class="container">
    <div class="row mt-5">
        <!-- Imagen del producto -->
        <div class="col-md-6">
            <img src="@producto.ImagenPath" alt="@producto.Nombre" class="img-fluid"
                 style="max-height: 500px; object-fit: contain;" onerror="this.src='/images/Productos/default.jpg';" />
        </div>

        <!-- Detalles del producto -->
        <div class="col-md-6">
            <h2 class="fw-bold">
                @producto.Nombre
                @if (producto.Stock == 0)
                {
                    <span class="text-danger"> - No hay stock!</span>
                }
            </h2>
            <p><strong>Descripción:</strong> @producto.Descripcion</p>
            <p class="text-muted"><strong>Categoría:</strong> @producto.Categoria?.Nombre</p>
            <p class="text-muted"><strong>Subcategoría:</strong> @producto.Subcategoria?.NombreSubcategoria</p>

            <p class="fw-bold text-primary" style="font-size: 1.5rem;">
                @producto.PrecioVenta.ToString("C", System.Globalization.CultureInfo.CreateSpecificCulture("es-EC"))
            </p>

            <form asp-controller="Compras" asp-action="AnadirAlCarrito" method="post" class="add-to-cart-form">
                <input asp-for="ProductoID" type="hidden" name="productoID" value="@producto.ProductoID" />
                <input asp-for="Cantidad" type="hidden" name="cantidad" value=1 />
                <div class="mb-3">
                    <label for="Cantidad" class="form-label">Cantidad</label>
                    <input type="number" id="Cantidad" name="Cantidad" class="form-control" min="1" max="@producto.Stock" value="1" @(producto.Stock == 0 ? "disabled" : "") />
                </div>
                @if (producto.Stock == 0)
                {
                    <button class="btn btn-secondary" disabled><i class="fa fa-cart-plus"></i> Sin stock</button>
                }
                else
                {
                    <button class="btn btn-success" id="add-to-cart-btn" data-producto-id="@producto.ProductoID">
                        <i class="fa fa-cart-plus"></i> Añadir al carrito
                    </button>
                }
            </form>


            <a href="@Url.Action("Catalogo", "Compras")" class="btn btn-outline-primary mt-3">
                <i class="fa fa-arrow-left"></i> Volver al catálogo
            </a>
        </div>
    </div>

    <hr />

    <div class="row">
        <div class="col-md-12">
            <h4 class="fw-bold">Detalles adicionales</h4>
            <p>@producto.Descripcion</p>
        </div>
    </div>
</div>

<!-- Modal de éxito (opcional, solo markup, puedes activarlo vía JS si lo deseas) -->
<div class="modal fade" id="addToCartModal" tabindex="-1" aria-labelledby="addToCartModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addToCartModalLabel">Producto añadido al carrito</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                El producto ha sido añadido a tu carrito. ¿Deseas seguir comprando o ir al carrito?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Seguir comprando</button>
                <a href="@Url.Action("Carrito", "Compras")" class="btn btn-primary">Ir al carrito</a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Aquí puedes poner scripts para activar el modal, si quieres mostrarlo tras añadir -->
    <!-- Por ejemplo: -->
    <!--
    <script>
    // Ejemplo: mostrar modal si añades con AJAX o en respuesta al submit del formulario
    // $('#addToCartModal').modal('show');
    </script>
    -->
}
