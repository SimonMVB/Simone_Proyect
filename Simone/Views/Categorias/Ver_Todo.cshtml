@model Simone.ViewModels.ProductoFiltroViewModel
@{
    ViewData["Title"] = "Todos los productos";
}

<div class="ui grid stackable">
    <!-- Filtros -->
    <div class="four wide column">
        <form asp-action="Ver_Todo" method="get" class="ui form">
            <h4 class="ui dividing header">Filtrar productos</h4>

            <!-- Precio -->
            <div class="field">
                <label>Precio máximo:</label>
                <input type="range" name="PrecioMax" min="0" max="500" step="5" value="@Model.PrecioMax" oninput="document.getElementById('precioOutput').innerText = this.value">
                <p>Hasta: $<span id="precioOutput">@Model.PrecioMax</span></p>
            </div>

            <!-- Marca -->
            <div class="field">
                <label>Marca</label>
                @foreach (var marca in Model.MarcasDisponibles)
                {
                    <div class="ui checkbox">
                        <input type="checkbox" name="MarcasSeleccionadas" value="@marca" @(Model.MarcasSeleccionadas.Contains(marca) ? "checked" : "")>
                        <label>@marca</label>
                    </div>

                    <br />
                }
            </div>

            <!-- Color -->
            <div class="field">
                <label>Color</label>
                @foreach (var color in Model.ColoresDisponibles)
                {
                    <div class="ui checkbox">
                        <input type="checkbox" name="ColoresSeleccionados" value="@color" @(Model.ColoresSeleccionados.Contains(color) ? "checked" : "")>
                        <label>@color</label>
                    </div>

                    <br />
                }
            </div>

            <!-- Talla -->
            <div class="field">
                <label>Talla</label>
                @foreach (var talla in Model.TallasDisponibles)
                {
                    <div class="ui checkbox">
                        <input type="checkbox" name="TallasSeleccionadas" value="@talla" @(Model.TallasSeleccionadas.Contains(talla) ? "checked" : "")>
                        <label>@talla</label>
                    </div>

                    <br />
                }
            </div>

            <!-- Stock -->
            <div class="field">
                <div class="ui checkbox">
                    <input type="checkbox" name="SoloDisponibles" value="true" @(Model.SoloDisponibles ? "checked" : "")>
                    <label>Solo productos disponibles</label>
                </div>
            </div>

            <button type="submit" class="ui fluid primary button mt-3">
                <i class="filter icon"></i> Aplicar filtros
            </button>
        </form>
    </div>

    <!-- Resultados -->
    <div class="twelve wide column">
        <h3 class="ui header">
            <i class="boxes icon"></i>
            <div class="content">Productos disponibles</div>
        </h3>
        <div class="ui divider"></div>

        @if (Model.Productos.Any())
        {
            <div class="ui three stackable cards">
                @foreach (var producto in Model.Productos)
                {
                    <div class="card">
                        <div class="image">
                            <img src="~/images/productos/@(producto.ImagenesProductos.FirstOrDefault()?.RutaImagen ?? "default-product.png")" alt="@producto.Nombre" />
                        </div>
                        <div class="content">
                            <div class="header">@producto.Nombre</div>
                            <div class="meta">@producto.Categoria?.Nombre</div>
                            <div class="description">
                                <p>@producto.Descripcion</p>
                                <p><strong>$@producto.PrecioVenta.ToString("F2")</strong></p>
                                <p class="ui mini label @(producto.Stock > 0 ? "green" : "red")">Stock: @producto.Stock</p>
                            </div>
                        </div>
                        <div class="extra content">
                            @if (producto.Stock > 0)
                            {
                                <form asp-controller="Carrito" asp-action="AgregarAlCarrito" method="post">
                                    <input type="hidden" name="productoId" value="@producto.ProductoID" />
                                    <input type="hidden" name="cantidad" value="1" />
                                    <button type="submit" class="ui fluid primary button">
                                        <i class="cart plus icon"></i> Agregar al carrito
                                    </button>
                                </form>
                            }
                            else
                            {
                                <div class="ui disabled fluid red button">
                                    <i class="ban icon"></i> No disponible
                                </div>
                            }
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="ui warning message">
                <div class="header">No se encontraron productos</div>
                <p>Intenta modificar los filtros para ver más resultados.</p>
            </div>
        }
    </div>
</div>
