@model Simone.Models.Usuario

@{
    ViewData["Title"] = "Mi Perfil";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-5 perfil-container">
    <div class="card perfil-card">
        <div class="card-header">
            <h4><i class="fa-solid fa-user-circle me-2"></i>Mi Perfil</h4>
        </div>

        <div class="card-body">
            @if (TempData["MensajeExito"] != null || TempData["MensajeError"] != null)
            {
                var message = TempData["MensajeExito"] ?? TempData["MensajeError"];
                var alertClass = TempData["MensajeExito"] != null ? "alert-success" : "alert-danger";
                var iconClass = TempData["MensajeExito"] != null ? "fa-circle-check" : "fa-circle-exclamation";

                <div class="alert @alertClass">
                    <i class="fa-solid @iconClass me-2"></i> @message
                </div>
            }

            <form asp-action="ActualizarPerfil" asp-controller="Cuenta" method="post" enctype="multipart/form-data" id="formPerfil" class="needs-validation" novalidate>
                @Html.AntiForgeryToken()
                <input asp-for="Id" hidden />

                <div class="text-center mb-4">
                    @if (Model != null && !string.IsNullOrEmpty(Model.FotoPerfil))

                    {
                        <img src="@Model.FotoPerfil" class="rounded-circle shadow" style="width: 120px; height: 120px; object-fit: cover;" />
                    }
                    else
                    {
                        <div class="rounded-circle bg-secondary d-inline-flex align-items-center justify-content-center text-white" style="width: 120px; height: 120px; font-size: 40px;">
                            <i class="fa-solid fa-user"></i>
                        </div>
                    }
                    <!-- Botón personalizado para subir imagen -->
                    <div class="mb-3 text-center">
                        <input type="file" id="ImagenPerfil" name="ImagenPerfil" accept="image/*" hidden />
                        <button type="button" class="btn-upload" onclick="document.getElementById('ImagenPerfil').click()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon">
                                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z" />
                                <circle cx="12" cy="13" r="4" />
                            </svg>
                            <span class="label-upload">Tomar una Foto</span>
                        </button>
                    </div>



                    <div class="mb-3">
                        <label asp-for="NombreCompleto" class="form-label">Nombre completo</label>
                        <input asp-for="NombreCompleto" class="form-control" />
                        <span asp-validation-for="NombreCompleto" class="text-danger small"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="Telefono" class="form-label">Teléfono</label>
                        <input asp-for="Telefono" class="form-control" placeholder="09xxxxxxxx" />
                        <span asp-validation-for="Telefono" class="text-danger small"></span>
                    </div>


                    <div class="mb-3">
                        <label asp-for="Direccion" class="form-label">Dirección</label>
                        <input asp-for="Direccion" class="form-control" />
                        <span asp-validation-for="Direccion" class="text-danger small"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="Referencia" class="form-label">Referencia</label>
                        <input asp-for="Referencia" class="form-control" />
                        <span asp-validation-for="Referencia" class="text-danger small"></span>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Rol actual</label>
                        <input value="@ViewBag.RolUsuario" class="form-control" readonly />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Fecha de registro</label>
                        <input value="@(Model.FechaRegistro.ToShortDateString())" class="form-control" readonly />
                    </div>

                    <div class="mb-4">
                        <label class="form-label">Estado</label>
                        <input value="@(Model.Activo ? "Activo" : "Inactivo")" class="form-control text-success" readonly />
                    </div>

                    <button type="submit" class="btn btn-guardar w-100" id="btnPerfil">
                        <i class="fa-solid fa-floppy-disk me-2"></i>Guardar cambios
                    </button>

            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(function () {
            const $form = $('#formPerfil');
            const $btn = $('#btnPerfil');

            $form.on('submit', function (e) {
                // Verifica con jQuery Validate si el formulario es válido
                if (!$form.valid()) {
                    e.preventDefault(); // cancela envío
                    return; // no cambia botón
                }

                // Si es válido, desactiva botón y muestra spinner
                $btn.prop('disabled', true);
                $btn.html('<span class="spinner-border spinner-border-sm me-2"></span>Guardando...');
            });
        });
    </script>
}




<style>
    .btn-guardar {
        background: linear-gradient(135deg, #f9d5ec, #f4a7c1);
        color: white;
        font-weight: bold;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        transition: all 0.3s ease;
    }

        .btn-guardar:hover {
            background: linear-gradient(135deg, #f4a7c1, #f9d5ec);
            color: white;
            box-shadow: 0 4px 12px rgba(244, 167, 193, 0.4);
        }

        .btn-guardar:focus {
            outline: none;
            box-shadow: 0 0 0 0.2rem rgba(244, 167, 193, 0.4);
        }

    .perfil-container {
        max-width: 650px;
        margin: 3rem auto;
        animation: fadeIn 0.6s ease-in-out;
    }

    .perfil-card {
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        overflow: hidden;
    }

        .perfil-card .card-header {
            background: linear-gradient(135deg, #f9d5ec, #f4a7c1);
            color: white;
            text-align: center;
            padding: 1.5rem;
        }

        .perfil-card .card-body {
            padding: 2rem;
            background-color: #fafafa;
        }

        .perfil-card .form-label {
            font-weight: 600;
        }

        .perfil-card .form-control:read-only {
            background-color: #e9ecef;
            font-style: italic;
        }

        .perfil-card .btn-primary {
            background-color: #f4a7c1;
            border: none;
            font-weight: 600;
        }

            .perfil-card .btn-primary:hover {
                background-color: #f4a7c1;
            }

    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }







    /* From Uiverse.io by andrew-demchenk0 */
    .button {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 9px 12px;
        gap: 8px;
        height: 40px;
        width: 172px;
        border: none;
        background: #FF2849;
        border-radius: 20px;
        cursor: pointer;
    }

    .lable {
        line-height: 22px;
        font-size: 17px;
        color: #fff;
        font-family: sans-serif;
        letter-spacing: 1px;
    }

    .button:hover {
        background: #e52441;
    }

        .button:hover .svg-icon {
            animation: flickering 2s linear infinite;
        }

    /* From Uiverse.io by andrew-demchenk0 */
    .button {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 9px 12px;
        gap: 8px;
        height: 40px;
        width: 172px;
        border: none;
        background: #FF2849;
        border-radius: 20px;
        cursor: pointer;
    }

    .lable {
        line-height: 22px;
        font-size: 17px;
        color: #fff;
        font-family: sans-serif;
        letter-spacing: 1px;
    }

    .button:hover {
        background: #e52441;
    }

        .button:hover .svg-icon {
            animation: flickering 2s linear infinite;
        }

    @@keyframes flickering {
        0% {
            opacity: 1;
        }

        50% {
            opacity: 1;
        }

        52% {
            opacity: 1;
        }

        54% {
            opacity: 0;
        }

        56% {
            opacity: 1;
        }

        90% {
            opacity: 1;
        }

        92% {
            opacity: 0;
        }

        94% {
            opacity: 1;
        }

        96% {
            opacity: 0;
        }

        98% {
            opacity: 1;
        }

        99% {
            opacity: 0;
        }

        100% {
            opacity: 1;
        }
    }

    keyframes flickering {
        0%

    {
        opacity: 1;
    }

    50% {
        opacity: 1;
    }

    52% {
        opacity: 1;
    }

    54% {
        opacity: 0;
    }

    56% {
        opacity: 1;
    }

    90% {
        opacity: 1;
    }

    92% {
        opacity: 0;
    }

    94% {
        opacity: 1;
    }

    96% {
        opacity: 0;
    }

    98% {
        opacity: 1;
    }

    99% {
        opacity: 0;
    }

    100% {
        opacity: 1;
    }


    }
</style>