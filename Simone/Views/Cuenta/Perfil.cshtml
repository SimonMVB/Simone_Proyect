@model Simone.Models.Usuario

@{
    ViewData["Title"] = "Mi Perfil";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="profile-container">
    <div class="profile-card">
        <div class="profile-header">
            <h2><i class="fas fa-user-circle me-2"></i>Mi Perfil</h2>
            <p class="profile-subtitle">Administra tu información personal</p>
        </div>

        <div class="profile-body">
            @if (TempData["MensajeExito"] != null || TempData["MensajeError"] != null)
            {
                var message = TempData["MensajeExito"] ?? TempData["MensajeError"];
                var alertClass = TempData["MensajeExito"] != null ? "alert-success" : "alert-danger";
                var iconClass = TempData["MensajeExito"] != null ? "fa-circle-check" : "fa-circle-exclamation";

                <div class="profile-alert @alertClass">
                    <i class="fas @iconClass me-2"></i> @message
                </div>
            }

            <form asp-action="ActualizarPerfil" asp-controller="Cuenta" method="post" enctype="multipart/form-data" id="formPerfil" class="needs-validation" novalidate>
                @Html.AntiForgeryToken()
                <input asp-for="Id" hidden />

                <!-- Profile Avatar Section -->
                <div class="profile-avatar-container">
                    <div class="avatar-wrapper">
                        @if (Model != null && !string.IsNullOrEmpty(Model.FotoPerfil))
                        {
                            <img src="@Model.FotoPerfil" class="profile-avatar" alt="Foto de perfil" />
                        }
                        else
                        {
                            <div class="avatar-placeholder">
                                <i class="fas fa-user"></i>
                            </div>
                        }
                    </div>

                    <div class="avatar-upload">
                        <input type="file" id="ImagenPerfil" name="ImagenPerfil" accept="image/*" hidden />
                        <label for="ImagenPerfil" class="upload-btn">
                            <i class="fas fa-camera me-2"></i> Cambiar foto
                        </label>
                        <small class="upload-hint">Formatos: JPG, PNG (max 5MB)</small>
                    </div>
                </div>

                <!-- Personal Information Form -->
                <div class="profile-form-grid">
                    <!-- Full Name -->
                    <div class="form-group">
                        <label asp-for="NombreCompleto" class="form-label">Nombre completo</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-user"></i></span>
                            <input asp-for="NombreCompleto" class="form-control" />
                        </div>
                        <span asp-validation-for="NombreCompleto" class="form-error"></span>
                    </div>

                    <!-- Phone -->
                    <div class="form-group">
                        <label asp-for="Telefono" class="form-label">Teléfono</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-phone"></i></span>
                            <input asp-for="Telefono" class="form-control" placeholder="09xxxxxxxx" />
                        </div>
                        <span asp-validation-for="Telefono" class="form-error"></span>
                    </div>

                    <!-- Address -->
                    <div class="form-group">
                        <label asp-for="Direccion" class="form-label">Dirección</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
                            <input asp-for="Direccion" class="form-control" />
                        </div>
                        <span asp-validation-for="Direccion" class="form-error"></span>
                    </div>

                    <!-- Reference -->
                    <div class="form-group">
                        <label asp-for="Referencia" class="form-label">Referencia</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-info-circle"></i></span>
                            <input asp-for="Referencia" class="form-control" />
                        </div>
                        <span asp-validation-for="Referencia" class="form-error"></span>
                    </div>

                    <!-- Current Role -->
                    <div class="form-group">
                        <label class="form-label">Rol actual</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-user-tag"></i></span>
                            <input value="@ViewBag.RolUsuario" class="form-control" readonly />
                        </div>
                    </div>

                    <!-- Registration Date -->
                    <div class="form-group">
                        <label class="form-label">Fecha de registro</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                            <input value="@(Model.FechaRegistro.ToShortDateString())" class="form-control" readonly />
                        </div>
                    </div>

                    <!-- Status -->
                    <div class="form-group">
                        <label class="form-label">Estado</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-circle"></i></span>
                            <input value="@(Model.Activo ? "Activo" : "Inactivo")" class="form-control" readonly />
                            <span class="input-group-text status-icon @(Model.Activo ? "active" : "inactive")">
                                <i class="fas @(Model.Activo ? "fa-check" : "fa-times")"></i>
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Save Button -->
                <div class="form-actions">
                    <button type="submit" class="save-btn" id="btnPerfil">
                        <i class="fas fa-save me-2"></i>
                        <span class="btn-text">Guardar cambios</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(function () {
            const $form = $('#formPerfil');
            const $btn = $('#btnPerfil');

            $form.on('submit', function (e) {
                if (!$form.valid()) {
                    e.preventDefault();
                    return;
                }

                $btn.prop('disabled', true);
                $btn.find('.btn-text').text('Guardando...');
                $btn.prepend('<span class="spinner-border spinner-border-sm me-2"></span>');
            });

            // Mostrar vista previa de la imagen seleccionada
            $('#ImagenPerfil').change(function() {
                if (this.files && this.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function(e) {
                        $('.profile-avatar').attr('src', e.target.result).show();
                        $('.avatar-placeholder').hide();
                    }

                    reader.readAsDataURL(this.files[0]);
                }
            });
        });
    </script>
}
