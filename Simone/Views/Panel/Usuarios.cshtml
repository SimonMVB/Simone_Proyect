@{
    ViewData["Type"] = "Usuario";
    ViewData["Title"] = "Gestión de " + ViewData["Type"];
}

<div class="ui container mt-5">
    <div class="ui segment">
        <h2 class="ui header">
            <i class="users icon"></i>
            <div class="content">@ViewData["Title"]</div>
        </h2>

        <table class="ui celled striped table">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Email</th>
                    <th>Teléfono</th>
                    <th>Dirección</th>
                    <th>Fecha de Registro</th>
                    <th>Rol</th>
                    <th>Opciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var usuario in ViewBag.Usuarios)
                {
                    <tr>
                        <td>@usuario.NombreCompleto</td>
                        <td>@usuario.Email</td>
                        <td>@usuario.Telefono</td>
                        <td>@usuario.Direccion</td>
                        <td>@(usuario.FechaRegistro?.ToString("dd/MM/yyyy") ?? "-")</td>
                        <td>
                            <form method="post" style="display:inline" asp-controller="Panel" asp-action="EditarRol">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="usuarioID" value="@usuario.Id" />
                                <select name="nuevoRolID" class="ui dropdown" id="roleNameDropdown_@usuario.Id" onChange="this.form.submit();">
                                    <option value="" disabled>Seleccione un Rol</option>
                                    @foreach (var role in ViewBag.Roles)
                                    {
                                        <option value="@role.Id" data-role-id="@role.Id">
                                            @role.Name
                                        </option>
                                    }
                                </select>

                                <script>
                                    document.addEventListener('DOMContentLoaded', function () {
                                        var selectedRoleId = '@usuario.RolID';
                                        var dropdown = document.getElementById("roleNameDropdown_@usuario.Id");
                                        var options = dropdown.querySelectorAll('option');

                                        options.forEach(function (option) {
                                            if (option.getAttribute('data-role-id') === selectedRoleId) {
                                                option.selected = true;
                                            }
                                        });
                                    });
                                </script>
                            </form>
                        </td>
                        <td>
                            <form method="post" style="display:inline" asp-controller="Panel" asp-action="EliminarUsuario" asp-route-id="@usuario.Id" onsubmit="return confirm('¿Estás seguro de eliminar este usuario?');">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="ui icon red button" title="Eliminar @ViewData["Type"]">
                                    <i class="trash icon"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
