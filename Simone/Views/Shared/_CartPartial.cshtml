@model IEnumerable<Simone.Models.CarritoDetalle>

<div class="cart-partial">
    <h5 class="mb-3">Mis artículos</h5>
    <hr />
    @if (Model == null || !Model.Any())
    {
        <div class="alert alert-info" role="alert">
            No tienes artículos en tu carrito.
        </div>
    }
    else
    {
        <ul class="list-group">
            @foreach (var item in Model)
            {
                <li class="list-group-item">
                    <div class="row align-items-center">
                        <!-- Columna para la imagen (si tienes la propiedad "Imagen") -->
                        <div class="col-3">
                            <img src="@item.Producto.ImagenPath"
                                 alt="@item.Producto.Nombre"
                                 class="img-fluid"
                                 onerror="this.src='/images/Productos/default.jpg';" />
                        </div>
                        <!-- Columna con detalles del producto -->
                        <div class="col-6">
                            <h6 class="mb-1">@item.Producto.Nombre</h6>
                            <p class="mb-1"><small>Cantidad: @item.Cantidad</small></p>
                            <p class="mb-1"><small>Precio: @item.Precio.ToString("C", CultureInfo.CreateSpecificCulture("en-US"))</small></p>
                        </div>
                        <!-- Columna con total y botón de acción -->
                        <div class="col-3 text-end">
                            <p class="mb-1 fw-bold">@item.Total.ToString("C", CultureInfo.CreateSpecificCulture("en-US"))</p>
                            <form asp-controller="Compras" asp-action="EliminarArticulo" method="post">
                                <input type="hidden" name="carritoDetalleID" value="@item.CarritoDetalleID" />
                                <button type="submit" class="btn btn-sm btn-danger remove-item" title="Eliminar artículo">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                </li>
            }
        </ul>

        <!-- Total general del carrito -->
        <div class="mt-3 text-end">
            @{
                decimal totalCompra = Model.Sum(x => x.Total);
            }
            <h5>Total: @totalCompra.ToString("C", CultureInfo.CreateSpecificCulture("en-US"))</h5>
        </div>

        <!-- "Comprar Ahora" Button (Only visible if user is logged in and cart has items) -->
        @if (User.Identity.IsAuthenticated && Model.Any())
        {
            <a href="@Url.Action("Resumen", "Compras")" class="btn btn-lg btn-success w-100 mt-3">
                <i class="fa fa-shopping-cart me-2"></i> Comprar Ahora
            </a>
        }
    }
</div>
