@{
    ViewData["Title"] = "Gestión de Usuarios";
}

<div class="ui container mt-5">
    <div class="ui segment">
        <h2 class="ui header">
            <i class="users icon"></i>
            <div class="content">Gestión de Usuarios</div>
        </h2>

        <table class="ui celled striped table">
            <thead>
                <tr>
                    <th>Email</th>
                    <th>Nombre</th>
                    <th>Rol</th>
                    <th>Opciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var usuario in ViewBag.Usuarios)
                {
                    <tr>
                        <td>@usuario.Email</td>
                        <td>@usuario.NombreCompleto</td>
                        <td>
                            <form method="post" style="display:inline" asp-controller="Admin" asp-action="EditarRol">
                                @Html.AntiForgeryToken()

                                <!-- Input partial el userId -->
                                <input type="hidden" name="usuarioID" value="@usuario.Id" />

                                <!-- Dropdown de Selecciona de rol -->
                                <select name="nuevoRolID" 
                                        class="ui dropdown" 
                                        id="roleNameDropdown_@usuario.Id" 
                                        onChange="this.form.submit();">
                                    <option value="" disabled selected>Seleccione un Rol</option>
                                    @foreach (var role in ViewBag.Roles)
                                    {
                                        <option value="@role.Id" data-role-id="@role.Id">
                                            @role.Name
                                        </option>
                                    }
                                </select>

                                <script>
                                    document.addEventListener('DOMContentLoaded', function () {
                                        var selectedRoleId = '@usuario.RolID';
                                        var dropdown = document.getElementById("roleNameDropdown_@usuario.Id");
                                        var options = dropdown.querySelectorAll('option');

                                        options.forEach(function (option) {
                                            if (option.getAttribute('data-role-id') === selectedRoleId) {
                                                option.selected = true; // Selecciona el rol asignado
                                            }
                                        });
                                    });
                                </script>
                            </form>

                        </td>
                        <td>
                            <!-- Borrar Usuario -->
                            <form method="post" style="display:inline" asp-controller="Admin" asp-action="EliminarUsuario"
                                asp-route-id="@usuario.Id"
                                onsubmit="return confirm('¿Estás seguro de eliminar este usuario?');">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="ui icon red button" title="Eliminar Usuario">
                                    <i class="trash icon"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
